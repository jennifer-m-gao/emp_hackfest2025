<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Seattle Map – draggable, colored areas, clickable icons</title>
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  
  <style>
    html, body { 
      height: 100%; 
      margin: 0; 
      font-family: 'Inter', sans-serif;
    }
    #map { height: 100%; width: 80%; }

    /*dif sidebar*/
    .layout {
      display: flex;
      height: 100vh; /* full height */
    }
    .sidebar-left {
        width: 250px;
        background-color: #b62222;
        color: #ffffff;
        min-height: calc(100vh - 0px); 
        display: flex;
        flex-direction: column;
        padding-top: 1rem;
    }

    .sidebar-logo {
        text-align: center;
    }
    .sidebar-logo img {
        max-width: 150px;
        height: auto;
    }

    .sidebar-left ul {
        list-style: none;
        padding: 0;
        margin: 0;
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .sidebar-left a {
        text-decoration: none;
        color: #ffffff;
        font-weight: bold;
        padding: 0.75rem 1.25rem;
        display: block;
        transition: background-color 0.25s ease;
    }

    .sidebar-left a:hover {
        background-color: rgba(255, 255, 255, 0.15);
        border-radius: 4px;
    }

    .sidebar-left .help-btn {
        background-color: #ffffff;
        color: #b62222 !important;
        text-align: center;
        border-radius: 4px;
    }

    .sidebar-left .help-btn:hover {
        background-color: #c49f25;
    }

    .page-content {
        padding-top: 60px; 
        padding-left: 250px; 
        padding-right: 1rem;
    }



    #map {
      flex: 1; /* take up remaining space */
    }


    .leaflet-popup-content-wrapper {
      background: #1e293b;  
      color: #f1f5f9;       
      border-radius: 12px;  
      box-shadow: 0 4px 10px rgba(0,0,0,0.4);
      z-index: 1200;
    }

    .leaflet-popup-tip {
      background: #1e293b;   
    }


    .leaflet-popup-content { font: 14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }

    .popup-content {
    font: 14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
  }

  .popup-content p {
    margin: 4px 0;
  }

  .status.stable {
    color: #22c55e; 
    font-weight: bold;
  }
  .status.serious {
    color: #eab308; 
    font-weight: bold;
  }
  .status.critical {
    color: #ef4444;
    font-weight: bold;
  }

  .alert {
      position:fixed;
      border-color: rgb(201, 38, 38);
      color: rgb(201, 38, 38);
      border-width: 3px;
      width: 40vw;
      height: 7vh;
      margin-top: 1.5vh;
      font-size: 125%;
      left: 35%;
      z-index: 1000;
  }

  back-button {
        background-color: var(--white);
        width: 100%;
        display: flex;
        justify-content: flex-start;
    }

    .back-button button {
        margin-top: 40vh;
        margin-left: 3.65vw;
        padding: 0.65rem 1.45rem;
        background-color: var(--white);
        color: var(--dark-green);
        border: none;
        border-radius: 6px;
        font-weight: bold;
        cursor: pointer;
        font-family: 'Inter', sans-serif;
        font-size: 1.15rem;
        transition: background-color 0.25s ease, transform 0.2s ease;
        border: 2px solid white;
    }

    .back-button button:hover {
        background-color: #f1e9c8;
        transform: translateY(-2px);
    }

  </style>
</head>
<body>
  <button class="alert">ALERT! 5.0 magnitude earthquake reported in the Pudget Sound region!</button>
  <div class="layout">
    <div class="sidebar-left">
      <div class="sidebar-logo">
        <img src="media/logo.png" alt="Logo">
      </div>
      <ul>
        <li><a href="paramedicsDashboard.html">Dashboard</a></li>
        <li><a href="userDashboard.html">Profile</a></li>
        <div class="back-button">
            <button type="button" onclick="window.location.href='index.html'">
                ← Logout
            </button>
        </div>
      </ul>
    </div>

    <div id="map"></div>
  </div>
  <div id="peopleContainer"></div>
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>
  <script>
    const map = L.map('map', {
      zoomControl: true, 
      dragging: true,   
    }).setView([47.6062, -122.3321], 9);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    const areas = [
      {
        name: 'earthquake',
        color: '#ef4444', 
        coords: [
          [47.863252, -123.254382],
          [47.863252, -121.875549],
          [47.010633, -121.875549],
          [47.010633, -123.254382]
        ]
      }
    ];

    areas.forEach(a => {
      const poly = L.polygon(a.coords, {
        color: a.color,
        weight: 2,
        fillColor: a.color,
        fillOpacity: 0.25
      }).addTo(map)
    });

    const greenIcon = new L.icon({ iconUrl:'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-green.png', shadowUrl:'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png', iconSize:[25,41], iconAnchor:[12,41], popupAnchor:[1,-34], shadowSize:[41,41] });
    const yellowIcon = new L.icon({ iconUrl:'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-yellow.png', shadowUrl:'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png', iconSize:[25,41], iconAnchor:[12,41], popupAnchor:[1,-34], shadowSize:[41,41] });
    const redIcon = new L.icon({ iconUrl:'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png', shadowUrl:'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png', iconSize:[25,41], iconAnchor:[12,41], popupAnchor:[1,-34], shadowSize:[41,41] });

    const statuses = [
        { name: "stable", minHR: 60, maxHR: 100, probability: 0.6, minTemp: 97, maxTemp: 100, icon: greenIcon},
        { name: "serious", minHR: 40, maxHR: 60, probability: 0.3, minTemp: 95, maxTemp: 96.99, icon: yellowIcon},
        { name: "critical", minHR: 0, maxHR: 40, probability: 0.1, minTemp: 90, maxTemp: 95, icon: redIcon}
    ];

    function pickStatus() {
        const randomNum = Math.floor(Math.random() * 10) + 1;
        if (randomNum <= 7){
            return statuses[0];
        } else if (randomNum <= 9){
            return statuses[1];
        } else {
            return statuses[2];
        }   
    }

    function Person(age, gender, X, Y, amenities, numpeople){
        this.age = age;
        this.gender = gender;
        this.X = X;
        this.Y = Y;
        this.status = pickStatus();
        this.heartRate = Math.random() * (this.status.maxHR - this.status.minHR) + this.status.minHR;
        this.bodyTemp = Math.random() * (this.status.maxTemp - this.status.minTemp) + this.status.minTemp;
        this.amenities = amenities;
        this.numpeople = numpeople;
    }

    function updatePerson(person){
        let change;
        switch(person.status.name) {
            case "stable":
                change = Math.random() * 1;
                break;
            case "serious":
                change = Math.random() * 2;
                break;
            case "critical":
                change = Math.random() * 4;
                break;
        }

        if (Math.random() > 0.5) {
            change -= change;
        } else {
            person.heartRate += change;
        }

        // Clamp heartRate to realistic range (20–200 bpm)
        if (person.heartRate < 20) person.heartRate = 20;
        if (person.heartRate > 200) person.heartRate = 200;

        if (person.heartRate > 60){
            person.status = statuses[0];
        } else if (person.heartRate > 40){
            person.status = statuses[1];
        } else {
            person.status = statuses[2];
        }

        let chance = Math.random();
        switch(person.status.name){
            case "stable":
              if (chance > 0.5){
                person.bodyTemp += Math.random() * 2;
              } else {
                person.bodyTemp -= Math.random() * 2;
              }
              break;
            case "serious":
              if (chance > 0.5){
                person.bodyTemp += Math.random() * 3;
              } else {
                person.bodyTemp -= Math.random() * 3;
              }
              break;
            case "critical":
              if (chance > 0.5){
                person.bodyTemp += Math.random() * 4;
              } else {
                person.bodyTemp -= Math.random() * 4;
              }
              break;
        }

        // Clamp bodyTemp to realistic human range (80–110 °F)
        if (person.bodyTemp < 80) person.bodyTemp = 80;
        if (person.bodyTemp > 110) person.bodyTemp = 110;

        if (person.bodyTemp < 95){
          person.status = statuses[2];
        } else if (person.bodyTemp < 97){
          person.status = statuses[1];
        } else {
          person.status = statuses[0];
        }
    }


    const people = [];
    const markers = [];

    people.push(new Person(32, "female", 47.6097, -122.3331, '', '9'));
    people.push(new Person(45, "male", 47.6205, -122.3493, '', '9'));
    people.push(new Person(27, "female", 47.6550, -122.3080, '', '9'));
    people.push(new Person(53, "male", 47.5301, -122.0326, '', '9'));
    people.push(new Person(19, "female", 47.7557, -122.3415, '', '9'));
    people.push(new Person(68, "male", 47.3073, -122.2285, '', '9'));
    people.push(new Person(8, "female", 47.4874, -122.2171, '', '9'));
    people.push(new Person(39, "male", 47.6786, -122.1316, '', '9'));
    people.push(new Person(24, "female", 47.6104, -122.2007, '', '9'));
    people.push(new Person(60, "male", 47.4490, -122.3088, '', '9'));
    people.push(new Person(72, "female", 47.5407, -122.3877, '', '9'));
    people.push(new Person(34, "male", 47.6156, -122.2119, '', '9'));
    people.push(new Person(51, "female", 47.4047, -122.3243, '', '9'));
    people.push(new Person(12, "male", 47.6790, -122.3870, '', '9'));
    people.push(new Person(83, "female", 47.7430, -122.1731, '', '9'));
    people.push(new Person(28, "female", 47.6782, -122.1760, '', '9'));
    people.push(new Person(36, "male", 47.7557, -122.3076, '', '9'));
    people.push(new Person(47, "female", 47.7089, -122.2030, '', '9'));
    people.push(new Person(22, "male", 47.6739, -122.1215, '', '9'));
    people.push(new Person(55, "female", 47.8209, -122.3151, '', '9'));


    function getPopupContent(person){
      return `
        <div class="popup-content">
          <p><strong>Age:</strong> ${person.age}</p>
          <p><strong>Gender:</strong> ${person.gender}</p>
          <p><strong>Heart rate:</strong> ${Math.round(person.heartRate)} bpm</p>
          <p><strong>Body Temperature:</strong> ${Math.round(person.bodyTemp)} °F</p>
          <p class="status ${person.status.name}"><strong>Status:</strong> ${person.status.name}</p>
          <p><strong>Amenities:</strong> ${person.amenities}</p>
          <p><strong>People:</strong> ${person.numpeople}</p>
        </div>
      `; 
    }


    people.push(new Person(32,"female",47.6097,-122.3331,"food, water, communication",2));
    people.push(new Person(45,"male",47.6205,-122.3493,"first aid",7));

    const submissions = JSON.parse(localStorage.getItem('submissions')) || [];
    function simulateSubmission(sub){
      const lat = 47.60 + (Math.random()-0.5)*0.1;
      const long = -122.33 + (Math.random()-0.5)*0.1;
      const gender = Math.random()>0.5?"male":"female";
      const p = new Person(
        Math.floor(Math.random()*61)+10,
        gender,
        lat,long,
        sub.amenities?sub.amenities.join(","):'',
        parseInt(sub['num-people'])||1
      );
      const danger = parseInt(sub['danger-level']);
      if(danger<=2) p.status=statuses[0];
      else if(danger==3) p.status=statuses[1];
      else p.status=statuses[2];
      if(sub['injury']=='yes'){p.heartRate*=0.9;p.bodyTemp-=1;}
      return p;
    }

    submissions.forEach(sub => {
      const p = simulateSubmission(sub);
      people.push(p);
    });

    people.forEach(person=>{
      const marker = L.marker([person.X, person.Y], { icon: person.status.icon }).addTo(map);
      marker.bindPopup(getPopupContent(person));
      markers.push(marker);
    });

    setInterval(()=>{
      const stored = JSON.parse(sessionStorage.getItem('submissions')) || [];
      stored.forEach(sub=>{
        if(!sub._added){
          const p = simulateSubmission(sub);
          people.push(p);
          const m = L.marker([p.X,p.Y],{icon:p.status.icon}).addTo(map);
          m.bindPopup(getPopupContent(p));
          markers.push(m);
          sub._added = true;
        }
      });
      sessionStorage.setItem('submissions',JSON.stringify(stored));
      

      people.forEach((p,i)=>{
        updatePerson(p);
        markers[i].setIcon(p.status.icon);
        const popup = markers[i].getPopup();
        popup.setContent(getPopupContent(p));
        if(popup.isOpen()) popup.update();
      });
    }, 1500);



    function onMapClick(e) {
        L.popup()
          .setLatLng(e.latlng)
          .setContent("You clicked the map at " + e.latlng.toString())
          .openOn(map);
    }

    map.on('click', onMapClick);
  </script>
</body>
</html>
