<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Seattle Map – draggable, colored areas, clickable icons</title>
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <style>
    html, body { height: 100%; margin: 0; }
    #map { height: 100%; width: 100%; }

    .leaflet-popup-content { font: 14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }

    .pin {
      width: 22px; height: 22px; border-radius: 50%;
      background: #1d4ed8; 
      display: grid; place-items: center; color: white; font-size: 12px; font-weight: 700;
      box-shadow: 0 1px 4px rgba(0,0,0,.4);
      transform: translate(-11px, -11px);
    }
    .pin::after { 
      content: "";
      position: absolute;
      width: 0; height: 0; left: 9px; top: 18px;
      border-left: 4px solid transparent;
      border-right: 4px solid transparent;
      border-top: 8px solid #1d4ed8;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <div id="peopleContainer"></div>
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>
  <script>
    const map = L.map('map', {
      zoomControl: true, 
      dragging: true,   
    }).setView([47.6062, -122.3321], 9);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    const areas = [
      {
        name: 'earthquake',
        color: '#ef4444', 
        coords: [
          [47.863252, -123.254382],
          [47.863252, -121.875549],
          [47.010633, -121.875549],
          [47.010633, -123.254382]
        ]
      }
    ];

    areas.forEach(a => {
      const poly = L.polygon(a.coords, {
        color: a.color,
        weight: 2,
        fillColor: a.color,
        fillOpacity: 0.25
      }).addTo(map);

      //poly.bindPopup(`<strong>${a.name}</strong>`);

    });


    var greenIcon = new L.icon({
      iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-green.png',
      shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',
      iconSize: [25, 41],
      iconAnchor: [12, 41],
      popupAnchor: [1, -34],
      shadowSize: [41, 41]
    });

    var redIcon = new L.icon({
      iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png',
      shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',
      iconSize: [25, 41],
      iconAnchor: [12, 41],
      popupAnchor: [1, -34],
      shadowSize: [41, 41]
    });

    var yellowIcon = new L.icon({
      iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-yellow.png',
      shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',
      iconSize: [25, 41],
      iconAnchor: [12, 41],
      popupAnchor: [1, -34],
      shadowSize: [41, 41]
    });

    const statuses = [
        { name: "stable", minHR: 60, maxHR: 100, probability: 0.6, minTemp: 97, maxTemp: 100, icon: greenIcon},
        { name: "critical", minHR: 40, maxHR: 60, probability: 0.3, minTemp: 95, maxTemp: 96.99, icon: yellowIcon},
        { name: "dying", minHR: 0, maxHR: 40, probability: 0.1, minTemp: 90, maxTemp: 95, icon: redIcon}
    ];

    function pickStatus() {
        const randomNum = Math.floor(Math.random() * 10) + 1;
        if (randomNum <= 7){
            return statuses[0];
        } else if (randomNum <= 9){
            return statuses[1];
        } else {
            return statuses[2];
        }   
    }

    function Person(age, gender, X, Y){
        this.age = age;
        this.gender = gender;
        this.X = X;
        this.Y = Y;
        this.status = pickStatus();
        this.heartRate = Math.random() * (this.status.maxHR - this.status.minHR) + this.status.minHR;
        this.bodyTemp = Math.random() * (this.status.maxTemp - this.status.minTemp) + this.status.minTemp;
    }

    function updatePerson(person){
        let change;
        switch(person.status.name) {
            case "stable":
                change = Math.random() * 1;
                break;
            case "critical":
                change = Math.random() * 2;
                break;
            case "dying":
                change = Math.random() * 4;
                break;
        }
        person.heartRate += change;

        if (person.heartRate > 60){
            person.status = statuses[0];
        } else if (person.heartRate > 40){
            person.status = statuses[1];
        } else {
            person.status = statuses[2];
        }

        let chance = Math.random();
        switch(person.status.name){
            case "stable":
              if (chance > 0.5){
                person.bodyTemp += Math.random() * 2;
              } else {
                person.bodyTemp -= Math.random() * 2;
              }
              break;
            case "critical":
              if (chance > 0.5){
                person.bodyTemp += Math.random() * 3;
              } else {
                person.bodyTemp -= Math.random() * 3;
              }
              break;
            case "dying":
              if (chance > 0.5){
                person.bodyTemp += Math.random() * 4;
              } else {
                person.bodyTemp -= Math.random() * 4;
              }
              break;
        }
        if (person.bodyTemp < 95){
          person.status = statuses[2];
        } else if (person.bodyTemp < 97){
          person.status = statuses[1];
        } else {
          person.status = statuses[0];
        };
    }

    const people = [];
    const markers = [];

    people.push(new Person(30, "female", 47.6062, -122.3321));
    people.push(new Person(25, "male", 47.6205, -122.3493));
    people.push(new Person(65, "male", 47.5952, -122.3316));

    function getPopupContent(person) {
      return `Age: ${person.age}<br/> Gender: ${person.gender}<br/> Heart rate: ${Math.round(person.heartRate)} bpm<br/> Body Temperature: ${Math.round(person.bodyTemp)}°F<br/> Status: ${person.status.name}`;
    }

    people.forEach(person => {
      const marker = L.marker([person.X, person.Y], { icon: person.status.icon }).addTo(map);
      marker.bindPopup(getPopupContent(person));
      markers.push(marker);
    });

    setInterval(() => {
      people.forEach((person, i) => {
        updatePerson(person);

        markers[i].setIcon(person.status.icon);
        const popup = markers[i].getPopup();
        popup.setContent(getPopupContent(person));

        if (popup.isOpen()) {
          popup.update();
        }
      });
    }, 1500);


    function onMapClick(e) {
        L.popup()
          .setLatLng(e.latlng)
          .setContent("You clicked the map at " + e.latlng.toString())
          .openOn(map);
    }

    map.on('click', onMapClick);
  </script>

</body>
</html>
