<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Seattle Map â€“ draggable, colored areas, clickable icons</title>
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <style>
    html, body { height: 100%; margin: 0; }
    #map { height: 100%; width: 100%; }

    .leaflet-popup-content { font: 14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }

    .pin {
      width: 22px; height: 22px; border-radius: 50%;
      background: #1d4ed8; 
      display: grid; place-items: center; color: white; font-size: 12px; font-weight: 700;
      box-shadow: 0 1px 4px rgba(0,0,0,.4);
      transform: translate(-11px, -11px);
    }
    .pin::after { 
      content: "";
      position: absolute;
      width: 0; height: 0; left: 9px; top: 18px;
      border-left: 4px solid transparent;
      border-right: 4px solid transparent;
      border-top: 8px solid #1d4ed8;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>
  <script>
    const map = L.map('map', {
      zoomControl: true, 
      dragging: true,   
    }).setView([47.6062, -122.3321], 9);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    const areas = [
      {
        name: 'earthquake',
        color: '#ef4444', 
        coords: [
          [47.863252, -123.254382],
          [47.863252, -121.875549],
          [47.010633, -121.875549],
          [47.010633, -123.254382]
        ]
      }
    ];

    areas.forEach(a => {
      const poly = L.polygon(a.coords, {
        color: a.color,
        weight: 2,
        fillColor: a.color,
        fillOpacity: 0.25
      }).addTo(map);

      //poly.bindPopup(`<strong>${a.name}</strong>`);

    });


    var greenIcon = new L.icon({
      iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-green.png',
      shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',
      iconSize: [25, 41],
      iconAnchor: [12, 41],
      popupAnchor: [1, -34],
      shadowSize: [41, 41]
    });

    var redIcon = new L.icon({
      iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png',
      shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',
      iconSize: [25, 41],
      iconAnchor: [12, 41],
      popupAnchor: [1, -34],
      shadowSize: [41, 41]
    });

    var yellowIcon = new L.icon({
      iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-yellow.png',
      shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',
      iconSize: [25, 41],
      iconAnchor: [12, 41],
      popupAnchor: [1, -34],
      shadowSize: [41, 41]
    });


    function displayStatus(age, heartRate, injuries, needs) {
      if (age > 60 || age < 12) {
        return redIcon;
      }

      if (heartRate > 180 || heartRate < 40) {
        return redIcon;
      } else if (heartRate < 70 || heartRate > 120) {
        return yellowIcon;
      }

      if (injuries == "severe") {
        return redIcon;
      } else if (injuries == "moderate") {
        return yellowIcon;
      }

      if (needs == "high") {
        return redIcon;
      }
      return greenIcon;

    }
    genderList = ["male", "female"];
    var hr = 60 + Math.floor(Math.random()*40);
    var gender = genderList[Math.floor(Math.random()*2)];
    var age = 15 + Math.floor(Math.random()*70);


    L.marker([47.6090, -122.3310], { icon: displayStatus(hr, age, "moderate", "none")})
      .addTo(map)
      .bindPopup('<b>Pike Place (demo)</b><br/>Image-based marker with shadow.');

    L.marker([47.481945, -123.027649], { icon: greenIcon })
      .addTo(map)
      .bindPopup("Age: "+age+"<br/>Gender: "+gender+"<br/>Heart rate: " + hr + "<br/>Injuries: none<br/>Needs:");





    function onMapClick(e) {
        popup
            .setLatLng(e.latlng)
            .setContent("You clicked the map at " + e.latlng.toString())
            .openOn(map);
    }

    map.on('click', onMapClick);
  </script>

</body>
</html>
